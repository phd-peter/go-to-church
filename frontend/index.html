<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>êµíšŒ ê°€ëŠ” ê¸¸</title>
  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; margin: 0; padding: 20px; background-color: #f8f9fa; color: #333; }
    .container { max-width: 800px; margin: 0 auto; background: white; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); overflow: hidden; }
    header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; text-align: center; }
    h1 { margin: 0; font-size: 1.8em; }
    #timestamp { font-size: 1.1em; opacity: 0.9; }
    button { background: #667eea; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-size: 1em; margin: 20px 0; transition: background 0.3s; }
    button:hover { background: #5a67d8; }
    section { padding: 20px; border-bottom: 1px solid #eee; }
    section:last-child { border-bottom: none; }
    h2 { color: #4a5568; margin-top: 0; border-bottom: 2px solid #e2e8f0; padding-bottom: 10px; }
    .recommendations { display: grid; gap: 15px; }
    .card { background: #f7fafc; border: 1px solid #e2e8f0; border-radius: 8px; padding: 15px; }
    .rank { font-size: 1.2em; font-weight: bold; color: #667eea; display: inline-block; width: 30px; }
    .route { font-weight: bold; color: #2d3748; }
    .details { font-size: 0.9em; color: #718096; margin-top: 5px; }
    .time { color: #38a169; font-weight: 500; }
    .routes { display: none; } /* Hidden by default, toggle with JS */
    .routes.active { display: block; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { padding: 10px; text-align: left; border-bottom: 1px solid #eee; }
    th { background: #f7fafc; font-weight: 600; color: #4a5568; }
    .toggle-btn { background: none; border: 1px solid #cbd5e0; color: #4a5568; padding: 5px 10px; border-radius: 4px; cursor: pointer; margin-left: 10px; }
    .toggle-btn:hover { background: #edf2f7; }
    #loading { text-align: center; color: #718096; padding: 20px; }
    #error { color: #e53e3e; text-align: center; padding: 20px; background: #fed7d7; border-radius: 8px; margin: 20px; }
    @media (max-width: 600px) { body { padding: 10px; } .container { margin: 10px; border-radius: 8px; } }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>ğŸš† êµíšŒ ê°€ëŠ” ê¸¸</h1>
      <div id="timestamp">í˜„ì¬ ì‹œê°: --:--</div>
    </header>
    <section>
      <button onclick="fetchRecommendations()">ì¶”ì²œ ë³´ê¸° (ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸)</button>
      <div id="loading" style="display: none;">ë¡œë”© ì¤‘...</div>
      <div id="error" style="display: none;"></div>
      <div id="recommendations"></div>
    </section>
    <section>
      <h2>ìƒì„¸ ê²½ë¡œ ì •ë³´ <button class="toggle-btn" onclick="toggleRoutes()">ì „ì²´ ë³´ê¸°</button></h2>
      <div id="routes" class="routes">
        <div id="route1"></div>
        <div id="route2"></div>
      </div>
    </section>
  </div>

  <script>
    function toggleRoutes() {
      const routes = document.getElementById('routes');
      routes.classList.toggle('active');
      event.target.textContent = routes.classList.contains('active') ? 'ìˆ¨ê¸°ê¸°' : 'ì „ì²´ ë³´ê¸°';
    }

    async function fetchRecommendations() {
      const loading = document.getElementById('loading');
      const error = document.getElementById('error');
      const recommendationsDiv = document.getElementById('recommendations');
      const route1Div = document.getElementById('route1');
      const route2Div = document.getElementById('route2');
      const timestampDiv = document.getElementById('timestamp');

      loading.style.display = 'block';
      error.style.display = 'none';
      recommendationsDiv.innerHTML = '';
      route1Div.innerHTML = '';
      route2Div.innerHTML = '';

      try {
        const now = new Date();
        const hhmm = now.toTimeString().slice(0, 5);
        timestampDiv.textContent = `í˜„ì¬ ì‹œê°: ${hhmm}`;

        const res = await fetch(`https://go-to-church-backend.onrender.com/gotochurch?now=${hhmm}`);
        if (!res.ok) throw new Error(`API ì—ëŸ¬: ${res.status}`);
        const data = await res.json();

        // Recommendations: Top 5 as cards
        const recs = data.recommendations.slice(0, 5);
        recommendationsDiv.innerHTML = `
          <h3>ì¶”ì²œ ê²½ë¡œ (ë„ì°© ì‹œê°„ ìˆœ)</h3>
          <div class="recommendations">
            ${recs.map((r, i) => {
              const d = r.details;
              let routeName = data.routes[r.route].name;
              let keyTimes = '';
              if (r.route === 'route1') {
                keyTimes = `
                  <div>ì¶œë°œ: ${d['ë°±ì„ì—­ ì¶œë°œ']} (ì—­ê¹Œì§€: ${d['ì—­ê¹Œì§€ ê°€ëŠ” ì‹œê°„']}ë¶„)</div>
                  <div>í™˜ìŠ¹ ëŒ€ê¸°: ${d['í™˜ìŠ¹ ì‚¬ì´ì‹œê°„']}ë¶„</div>
                  <div>ë„ì°©: ${r.arrival_time} (${d['ë‘”ì´Œë™ì—­ ë„ì°©ì‹œê°„']})</div>
                `;
              } else {
                keyTimes = `
                  <div>ì¶œë°œ: ${d['ë‹¹ì‚°ì—­ ê¸‰í–‰ì¶œë°œ']} (ë²„ìŠ¤+ì´ë™: ${d['ë²„ìŠ¤íƒ€ëŸ¬ê°€ëŠ” ì‹œê°„ + ë²„ìŠ¤ê°€ ë‹¹ì‚°ê¹Œì§€ ê°€ëŠ” ì‹œê°„']}ë¶„)</div>
                  <div>ë„ì°©: ${r.arrival_time} (${d['ì¢…í•©ìš´ë™ì¥ì—­ ë„ì°©']})</div>
                `;
              }
              return `
                <div class="card">
                  <div><span class="rank">${r.rank}ìœ„</span> <span class="route">${routeName}</span></div>
                  <div class="details">${keyTimes}</div>
                </div>
              `;
            }).join('')}
          </div>
        `;

        // Full Routes: Tables
        const route1 = data.routes.route1;
        route1Div.innerHTML = `
          <h4>${route1.name}</h4>
          <table>
            <thead><tr><th>ì˜µì…˜</th><th>ì—­ê¹Œì§€</th><th>ë°±ì„ ì¶œë°œ</th><th>ì¢…ë¡œ3ê°€ ë„ì°©</th><th>í™˜ìŠ¹ ëŒ€ê¸°</th><th>ì¢…ë¡œ3ê°€ ì¶œë°œ</th><th>ë‘”ì´Œë™ ë„ì°©</th></tr></thead>
            <tbody>${route1.next.map((d, i) => `<tr><td>${i+1}</td><td>${d['ì—­ê¹Œì§€ ê°€ëŠ” ì‹œê°„']}ë¶„</td><td>${d['ë°±ì„ì—­ ì¶œë°œ']}</td><td>${d['ì¢…ë¡œ3ê°€ì—­ ë„ì°©']}</td><td>${d['í™˜ìŠ¹ ì‚¬ì´ì‹œê°„']}ë¶„</td><td>${d['ì¢…ë¡œ3ê°€ì—­ ì¶œë°œ']}</td><td class="time">${d['ë‘”ì´Œë™ì—­ ë„ì°©ì‹œê°„']}</td></tr>`).join('')}</tbody>
          </table>
        `;

        const route2 = data.routes.route2;
        route2Div.innerHTML = `
          <h4>${route2.name}</h4>
          <table>
            <thead><tr><th>ì˜µì…˜</th><th>ë²„ìŠ¤+ì´ë™</th><th>ë‹¹ì‚° ê¸‰í–‰ ì¶œë°œ</th><th>ì¢…í•©ìš´ë™ì¥ ë„ì°©</th></tr></thead>
            <tbody>${route2.next.map((d, i) => `<tr><td>${i+1}</td><td>${d['ë²„ìŠ¤íƒ€ëŸ¬ê°€ëŠ” ì‹œê°„ + ë²„ìŠ¤ê°€ ë‹¹ì‚°ê¹Œì§€ ê°€ëŠ” ì‹œê°„']}ë¶„</td><td>${d['ë‹¹ì‚°ì—­ ê¸‰í–‰ì¶œë°œ']}</td><td class="time">${d['ì¢…í•©ìš´ë™ì¥ì—­ ë„ì°©']}</td></tr>`).join('')}</tbody>
          </table>
        `;

        // Show routes by default after load
        document.getElementById('routes').classList.add('active');
        document.querySelector('.toggle-btn').textContent = 'ìˆ¨ê¸°ê¸°';

      } catch (err) {
        error.textContent = `ì˜¤ë¥˜: ${err.message}. ë„¤íŠ¸ì›Œí¬ë‚˜ ì„œë²„ í™•ì¸í•˜ì„¸ìš”.`;
        error.style.display = 'block';
      } finally {
        loading.style.display = 'none';
      }
    }

    // Initial load on page open
    fetchRecommendations();
  </script>
</body>
</html>
